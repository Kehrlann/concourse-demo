<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Concourse, l'intégration Cloud Native</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/night.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <style type="text/css">
        .reveal section img
        {
            border: none;
            background: none;
            box-shadow: none;
        }
    </style>
</head>
<body>
    <div class="reveal">
        <div class="slides">
            <section data-markdown>
                <textarea data-template>
                    # Concourse
                    ## Cloud-Native CI/CD
                    <br>
                    #### CD Meetup
                    #### Paris, 30 / 01 / 2018
                    <br>
                    <br>
                    Daniel Garnier-Moiroux

                    Software Engineer @ Pivotal Labs

                    [dgarnier@pivotal.io](mailto:dgarnier@pivotal.io)

                    [Kehrlann @ github](https://github.com/Kehrlann)
                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>
                    ## Au programme aujourd'hui
                    - Présentation générale de Concourse
                        - Le pourquoi du comment

                    - Concepts et fonctionnement
                        - Resources, jobs, pipelines
                        - Immutable GUI, the _fly_ CLI
                        - Architecture
                    - Mon premier pipeline
                        - De git push au déploiement
                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>

                    <img src="/img/concourse-logo.png" height=200 />

                    # Présentation
                    <br>
                    <br>
                    <br>
                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>
                    ## Concourse 

                    - Créé en 2014 chez Pivotal, pour les besoins de CI dans les équipes de développement de Pivotal Cloud Foundry
                        - Insatisfaction avec les outils existants (SaaS ou hosted)
                        - Expertise sur les containers acquise avec Cloud Foundry
                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>

                    ## Comparaisons avec d'autres outils
 
                    ### Jenkins
                    - Les serveurs deviennent des _snowflakes_, modification des configs directement sur le serveur 
                      - Difficile de customiser un serveur Concourse: tout est commité
                    - Pas de plugins mais des containers
                    - Pipelines Jenkins "officiels" depuis la version Blue Ocean (2017)
                      - Concourse a été construit autour de la notion de pipeline
                      - Dans Concourse, [resource] -> [job] -> [resource] -> [job] -> ...

                    <br>
                    ### SaaS tools (e.g. Travis)
                    - Des similarités importantes: travis.yml, containers par défaut.
                    - Pas de pipeline puissants (_Travis stages_ est en beta)
                    - Pas d'exécution de jobs "locaux", plein de petits commits de debug
                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>
                    ## Qui utilise Concourse ?
                    
                    <img src="/img/logos.png" height=640 />

                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>

                    <img src="/img/concourse-logo.png" height=200 />

                    # Sous le capot ...
                    <br>
                    <br>
                    <br>
                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>
                    ## Resource
                    
                    - Brique de base, que Concourse peut:
                        - _check_, pour découvrir des nouvelles versions
                        - _get_, pour l'utiliser dans un job/task
                        - _put_, pour y envoyer le résultat d'un job/task

                    - Interface unique, avec de nombreuses implémentations
                        - git
                        - s3
                        - time
                        - semver
                        - cf
                        - Plein de resources community ! (github, slack, jira, sonar ...) 

                    - Simple à implémenter: trois scripts dans un container de votre choix
                        - Voire moins, e.g. pour des resources _put_ only
                </textarea>
            </section>
            
            <section data-markdown>
                <textarea data-template>
                    ## Exemple de resource : git

                    - Définition :

                    ```yaml
                    resources:
                    - name: backend-repo
                      type: git
                      source:
                        uri: git@github.com/Kehrlann/concourse-demo.git
                        branch: master
                        private_key: ...
                        paths: [ci, backend]
                    ```

                    - Utilisation :

                    ```yaml
                    jobs:
                    - name: build-backend
                      plan:
                      - get: repo
                        resource: backend-repo
                        trigger: true
                      - ... [other tasks] ...
                    ```
                </textarea>
            </section>
            
            <section data-markdown>
                <textarea data-template>
                    ## Jobs

                    - Deuxième brique de base
                    - Série de steps:
                        - _task_, pour exécuter du code arbitraire dans un container
                        - _get_, pour récupérer des resources à utiliser en input
                            - Peut entraîner l'exécution du job ou non, via un flag _trigger_ 
                        - _put_, pour pousser des outputs de jobs vers des resources
                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>
                    ## Exemple de job

                    ### Dans le code

                    ```yaml
                    jobs:
                    - name: build-backend
                      plan:
                      - get: repo
                        resource: backend-repo
                        trigger: true
                      - task: build
                        file: repo/ci/tasks/build-backend.yml
                        params:
                          MY_ENV_VAR: value
                          OTHER_ENV_VAR: morevalues
                      - put: backend-bucket
                        path: output 
                    ```

                    ### Dans le GUI

                    <img src="/img/job.png" height=200 />

                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>
                    ## Pipeline 

                    - Assemblage de jobs qui tournent en parallèle ou séquentiellement
                    - Le lancement des jobs est contrôlé par les _resources_ quand il y a
                      une nouvelle version disponible
                    - Toute l'info est dans un fichier de configuration, e.g. `pipeline.yml`
                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>
                    ## Concourse UI 

                    - Le GUI est un site web, immutable
                    - Interaction via l'outil en CLI _`fly`_
                        - _`fly set-pipeline`_, _`fly trigger-job`_, ..
                        - _`fly execute`_ pour envoyer une _task_ à exécuter au worker
                        - _`fly intercept`_ pour exécuter un shell dans le container d'un job
                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>
                    ## Architecture

                    <img src="/img/architecture.png" height=800 />

                </textarea>
            </section>

            <section data-markdown>
                <textarea data-template>

                    <img src="/img/concourse-logo.png" height=200 />

                    # Ca suffit les slides, on veut du code !
                    <br>
                    <br>
                    <br>
                </textarea>
            </section>

        </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
            // More info about config & dependencies:
            // - https://github.com/hakimel/reveal.js#configuration
            // - https://github.com/hakimel/reveal.js#dependencies
            Reveal.initialize({
                width: 1400,
                height: 1080,
                history: true,
                dependencies: [
                { src: 'plugin/markdown/marked.js' },
                { src: 'plugin/markdown/markdown.js' },
                { src: 'plugin/notes/notes.js', async: true },
                { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                { src: 'plugin/notes-server/client.js', async: true }
                ]
            });
        </script>
    </body>
    </html>
